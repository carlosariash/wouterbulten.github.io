<script type="text/javascript">
/* https://github.com/muicss/loadjs */
!function(n,o){function e(n,o){n=n.push?n:[n];var e,t,r,i,u=[],f=n.length,c=f;for(e=function(n,e){e.length&&u.push(n),c-=1,0===c&&o(u)};f--;)t=n[f],r=a[t],r?e(t,r):(i=d[t]=d[t]||[],i.push(e))}function t(n,o){if(n){var e=d[n];if(a[n]=o,e)for(;e.length;)e[0](n,o),e.splice(0,1)}}function r(n,e){var t=o.createElement("script");t.src=n,t.onload=t.onerror=function(o){t.parentNode.removeChild(t),t=null,e(n,o.type)},f.appendChild(t)}function i(n,o){n=n.push?n:[n];var e,t=n.length,i=t,u=[];for(e=function(n,e){"error"===e&&u.push(n),i-=1,0===i&&o(u)};t--;)r(n[t],e)}function u(o,e,r,u){var f,a,d;if(e&&!e.call&&(f=e),a=f?r:e,d=f?u:r,f){if(f in l)throw new Error("LoadJS: Bundle already defined");l[f]=!0}n.setTimeout(function(){i(o,function(n){n.length?(d||c)(n):(a||c)(),t(f,n)})},0)}var f=o.head,c=function(){},l={},a={},d={};u.ready=function(n,o,t){return e(n,function(n){n.length?(t||c)(n):(o||c)()}),u},u.done=function(n){t(n,[])},n.loadjs=u}(window,document);

var preloadDependencies = [
  /* Always load jquery */
  'https://code.jquery.com/jquery-2.1.4.min.js',

  {% if page.chartjs %}
  '{{ "/assets/js/Chart.min.js" | prepend: site.baseurl  }}',
  {% endif %}

  {% if page.id and page.readingTime %}
  '{{ "/assets/js/readingTime.min.js" | prepend: site.baseurl  }}',
  {% endif %}
];

var pageScripts = [
  {% for script in page.post_scripts %}
  {% capture script_file %}/assets/js/post-scripts/{{ script }}.js{% endcapture %}
  '{{ script_file | prepend: site.baseurl  }}',
  {% endfor %}
];

/* First load main dependencies */
loadjs(preloadDependencies, 'page', function() {

  /* Load additional scripts */
  loadjs(pageScripts, 'custom-scripts');
});

/* Start page scripts after all dependencies have been loaded */
loadjs.ready('page', function() {
  $(document).ready(function(){

    // if(!(window.ga && ga.create)) {
    //   /* GA blocked */
    //   $.ajaxSetup({
    //     xhrFields: {
    //       withCredentials: true
    //     }
    //   });
    //   $.get('https://notify.wouterbulten.nl/notify/', {
    //     p: '{{ page.url }}',
    //     t: '{{ page.title }}'
    //   });
    // }

    var $window = $(window),
    $image = $('.post-image-image, .teaserimage-image');
    $window.on('scroll', function() {
      var top = $window.scrollTop();

      if (top < 0 || top > 1500) { return; }
      $image
        .css('transform', 'translate3d(0px, '+top/3+'px, 0px)')
        .css('opacity', 1-Math.max(top/700, 0));
    });
    $window.trigger('scroll');

    /*var height = $('.article-image').height();
    $('.post-content').css('padding-top', height + 'px');*/

    $('a[href*=#]:not([href=#])').click(function() {
      if (location.pathname.replace(/^\//,'') == this.pathname.replace(/^\//,'')
       && location.hostname == this.hostname) {
        var target = $(this.hash);
        target = target.length ? target : $('[name=' + this.hash.slice(1) +']');
        if (target.length) {
          $('html,body').animate({ scrollTop: target.offset().top }, 500);
          return false;
        }
      }
    });

    {% if page.readingTime %}
    /* Calculates Reading Time */
    $('.post-content').readingTime({
        readingTimeTarget: '.post-reading-time',
        wordCountTarget: '.post-word-count',
    });
    {% endif %}
    {% if page.id %}
    /* Creates Captions from Alt tags */
    $(".post-content img").each(function() {
        /* Let's put a caption if there is one */
        if($(this).attr("alt") && !$(this).hasClass("emoji"))
          $(this).wrap('<figure class="image"><\/figure>')
          .after('<figcaption>'+$(this).attr("alt")+'<\/figcaption>');
    });
    {% endif %}
  });
})
</script>

{%if page.math %}
<script async type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } },
  "HTML-CSS": {
    scale: 100
  },
  tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
  }
});
</script>
<script async type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
{% endif %}

<!-- Analytics code -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-11759031-3', 'auto');
ga('send', 'pageview');
</script>
